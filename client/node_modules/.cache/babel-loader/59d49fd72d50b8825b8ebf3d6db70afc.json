{"ast":null,"code":"'use strict';\n\nvar path = require('path');\n\nvar fs = require('graceful-fs');\n\nvar Vinyl = require('vinyl');\n\nvar through = require('through2');\n\nfunction prepareSymlink(folderResolver, optResolver) {\n  if (!folderResolver) {\n    throw new Error('Invalid output folder');\n  }\n\n  function normalize(file, enc, cb) {\n    if (!Vinyl.isVinyl(file)) {\n      return cb(new Error('Received a non-Vinyl object in `symlink()`'));\n    } // TODO: Remove this after people upgrade vinyl/transition from gulp-util\n\n\n    if (typeof file.isSymbolic !== 'function') {\n      file = new Vinyl(file);\n    }\n\n    var cwd = path.resolve(optResolver.resolve('cwd', file));\n    var outFolderPath = folderResolver.resolve('outFolder', file);\n\n    if (!outFolderPath) {\n      return cb(new Error('Invalid output folder'));\n    }\n\n    var basePath = path.resolve(cwd, outFolderPath);\n    var writePath = path.resolve(basePath, file.relative); // Wire up new properties\n    // Note: keep the target stats for now, we may need them in link-file\n\n    file.stat = file.stat || new fs.Stats();\n    file.cwd = cwd;\n    file.base = basePath; // This is the path we are linking *TO*\n\n    file.symlink = file.path;\n    file.path = writePath; // We have to set contents to null for a link\n    // Otherwise `isSymbolic()` returns false\n\n    file.contents = null;\n    cb(null, file);\n  }\n\n  return through.obj(normalize);\n}\n\nmodule.exports = prepareSymlink;","map":null,"metadata":{},"sourceType":"script"}