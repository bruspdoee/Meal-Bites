{"ast":null,"code":"'use strict';\n\nvar once = require('once');\n\nvar helpers = require('./helpers');\n\nfunction map(values, iterator, extensions, done) {\n  // Allow for extensions to not be specified\n  if (typeof extensions === 'function') {\n    done = extensions;\n    extensions = {};\n  } // Handle no callback case\n\n\n  if (typeof done !== 'function') {\n    done = helpers.noop;\n  }\n\n  done = once(done); // Will throw if non-object\n\n  var keys = Object.keys(values);\n  var length = keys.length;\n  var count = length;\n  var idx = 0; // Return the same type as passed in\n\n  var results = helpers.initializeResults(values);\n  var exts = helpers.defaultExtensions(extensions);\n\n  if (length === 0) {\n    return done(null, results);\n  }\n\n  for (idx = 0; idx < length; idx++) {\n    var key = keys[idx];\n    next(key);\n  }\n\n  function next(key) {\n    var value = values[key];\n    var storage = exts.create(value, key) || {};\n    exts.before(storage);\n    iterator(value, key, once(handler));\n\n    function handler(err, result) {\n      if (err) {\n        exts.error(err, storage);\n        return done(err, results);\n      }\n\n      exts.after(result, storage);\n      results[key] = result;\n\n      if (--count === 0) {\n        done(err, results);\n      }\n    }\n  }\n}\n\nmodule.exports = map;","map":null,"metadata":{},"sourceType":"script"}