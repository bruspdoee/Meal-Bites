{"ast":null,"code":"'use strict';\n\nvar through = require('through2');\n\nvar removeBom = require('remove-bom-buffer');\n\nvar SafeBuffer = require('safe-buffer').Buffer;\n\nfunction removeBomStream() {\n  var completed = false;\n  var buffer = SafeBuffer.alloc(0);\n  return through(onChunk, onFlush);\n\n  function removeAndCleanup(data) {\n    completed = true;\n    buffer = null;\n    return removeBom(data);\n  }\n\n  function onChunk(data, enc, cb) {\n    if (completed) {\n      return cb(null, data);\n    }\n\n    if (data.length >= 7) {\n      return cb(null, removeAndCleanup(data));\n    }\n\n    var bufferLength = buffer.length;\n    var chunkLength = data.length;\n    var totalLength = bufferLength + chunkLength;\n    buffer = SafeBuffer.concat([buffer, data], totalLength);\n\n    if (totalLength >= 7) {\n      return cb(null, removeAndCleanup(buffer));\n    }\n\n    cb();\n  }\n\n  function onFlush(cb) {\n    if (completed || !buffer) {\n      return cb();\n    }\n\n    cb(null, removeAndCleanup(buffer));\n  }\n}\n\nmodule.exports = removeBomStream;","map":null,"metadata":{},"sourceType":"script"}